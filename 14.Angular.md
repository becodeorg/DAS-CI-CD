# Mise en pratique avec un projet Angular 

## Création dur projet
(Sur votre machine)
```
ng new my-super-app
```
Pour installer et générer le fichier de configuation pour Eslint
```
ng lint
```
On créé un nouveau dépot gitlab (Sans readme.md) et on rajoute le remote dans l'application.
```
Push an existing Git repository
cd existing_repo
git remote rename origin old-origin
git remote add origin git@gitlab.das.becode:becode/my-web-app.git
git push --set-upstream origin --all
git push --set-upstream origin --tags
```

## Création du pipeline
Cette fois nous allons créer un pipeline en 4 étapes qui auront une ou plusieurs tâches.

- dependencies : Installation des dépendances NPM
- quality : Test unitaire et lint
- assemble : Compilation de l'application et push sur docker
- deploy : Deployement sur un serveur avec docker



```yaml
default:
  interruptible: true
  image: trion/ng-cli-karma:latest
  tags:
    - docker
  cache:
    key:
      files:
        - package.json
    paths:
      - node_modules


stages:
  - dependencies
  - quality
  - assemble
  - deploy

install:
  stage: dependencies
  before_script:
    # Install dependencies
    - npm ci --prefer-offline
  script:
    - ng build


lint:
  stage: quality
  needs: ["install"]
  script:
    - ng lint


test:
  stage: quality
  needs: ["lint"]
  script:
    - ng test --watch=false 

# assemble:
#   stage: assemble
#   needs: ["test", "lint"]
#   script:
#     - npm run build
#   artifacts:
#     paths:
#       - $CI_PROJECT_DIR/dist

# .deploy:
#   stage: deploy
#   variables:
#     NODE_ENV: production
#   needs: ["assemble"]
#   before_script:
#     - echo "Deploying to $CI_ENVIRONMENT_NAME"

# deploy-dev:
#   extends: .deploy
#   variables:
#     NODE_ENV: development
#   script:
#     - echo "Deploying to $CI_ENVIRONMENT_NAME"
#     - echo "Making actions to deploy to dev"
#     - echo "Deployed to $CI_ENVIRONMENT_NAME"

# deploy-staging:
#   extends: .deploy
#   rules:
#     - when: manual
#       allow_failure: true
#   variables:
#     NODE_ENV: staging
#   script:
#     - echo "Deploying to $CI_ENVIRONMENT_NAME"
#     - echo "Making actions to deploy to staging"
#     - echo "Deployed to $CI_ENVIRONMENT_NAM
```
